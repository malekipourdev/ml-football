# گزارش نهایی پروژه

## طبقه‌بندی عملکرد بازیکنان فوتبال با استفاده از یادگیری ماشین

---

**نام دانشجو:** [نام شما]  
**شماره دانشجویی:** [شماره دانشجویی]  
**درس:** [نام درس]  
**استاد راهنما:** [نام استاد]  
**تاریخ:** ۱۷ شهریور ۱۴۰۴

---

## فهرست مطالب

1. [مقدمه و تعریف مسئله](#مقدمه)
2. [بررسی داده‌ها](#بررسی-داده‌ها)
3. [روش‌شناسی](#روش‌شناسی)
4. [پیاده‌سازی و نتایج](#پیاده‌سازی-و-نتایج)
5. [بهبود عملکرد](#بهبود-عملکرد)
6. [نتیجه‌گیری](#نتیجه‌گیری)
7. [پیوست‌ها](#پیوست‌ها)

---

## 1. مقدمه و تعریف مسئله {#مقدمه}

### 1.1 هدف پروژه

این پروژه با هدف **طبقه‌بندی عملکرد بازیکنان فوتبال** بر اساس آمار بازی آن‌ها طراحی شده است. هدف اصلی، پیش‌بینی سطح عملکرد بازیکنان در چهار دسته **poor (ضعیف)**، **weak (متوسط)**، **good (خوب)** و **excellent (عالی)** است.

**ویژگی اصلی این پروژه:** استفاده از آمار بازی واقعی بازیکنان بدون هیچ‌گونه Data Leakage برای ایجاد یک سیستم طبقه‌بندی معنادار.

### 1.2 اهمیت موضوع

- **تحلیل عملکرد:** کمک به مربیان برای ارزیابی دقیق‌تر بازیکنان
- **انتقالات:** کمک به باشگاه‌ها در تصمیم‌گیری برای خرید بازیکن
- **توسعه بازیکن:** شناسایی نقاط قوت و ضعف
- **تحلیل تاکتیکی:** بهبود استراتژی‌های بازی

### 1.3 رویکرد پروژه

- **تمرکز اصلی:** طبقه‌بندی سطح عملکرد بازیکنان
- **جلوگیری از Data Leakage:** عدم استفاده از ویژگی‌هایی که مستقیماً target را فاش می‌کنند
- **ویژگی‌های معنادار:** استفاده از آمار بازی قابل اندازه‌گیری
- **هدف کاربردی:** کمک به تحلیل‌گران ورزشی و مربیان

---

## 2. بررسی داده‌ها {#بررسی-داده‌ها}

### 2.1 منبع داده‌ها

- **فایل:** `data_football_ratings.csv`
- **حجم:** 50,652 نمونه
- **ویژگی‌ها:** 63 ستون
- **دوره زمانی:** یورو 2016، جام جهانی 2018، لیگ‌های اروپایی 2017-18

### 2.2 ساختار داده‌ها

```
- competition: نوع مسابقه (یورو، جام جهانی، لیگ)
- team: نام تیم
- pos: پست کلی (GK, DF, MF, FW)
- pos_role: پست دقیق (DC, MC, Sub و غیره)
- player: نام بازیکن
- rater: رسانه رتبه‌دهنده
- original_rating: امتیاز اصلی (1-10 یا 1-6)
- آمار بازی: گل، پاس، تکل، اینترسپت و ...
```

### 2.3 کیفیت داده‌ها

- **مقدار مفقود:** صفر
- **تنوع رسانه‌ها:** 6 رسانه مختلف (Kicker, WhoScored, SofaScore, ...)
- **مقیاس‌های مختلف:** برخی 1-6، برخی 1-10

---

## 3. روش‌شناسی {#روش‌شناسی}

### 3.1 تعریف متغیر هدف

**رویکرد اصلی:** ایجاد کتگوری‌های عملکرد بر اساس `normalized_rating`:

```python
def create_performance_category(rating):
    if rating <= Q1: return 'poor'       # 25.2% (پایین‌ترین کارکردها)
    elif rating <= Q2: return 'weak'     # 28.2% (متوسط پایین)
    elif rating <= Q3: return 'good'     # 22.6% (متوسط بالا)
    else: return 'excellent'             # 23.9% (بهترین کارکردها)
```

**مزایا:**

- توزیع متعادل کلاس‌ها
- بدون Data Leakage
- قابل تفسیر برای تحلیل‌گران

### 3.2 پیش‌پردازش داده‌ها

#### 3.2.1 نرمال‌سازی امتیازها

```python
def normalize_rating(row):
    if row['rater'] in ['Kicker', 'Bild']:
        return (row['original_rating'] - 1) / 5  # مقیاس 1-6 به 0-1
    else:
        return (row['original_rating'] - 1) / 9  # مقیاس 1-10 به 0-1
```

#### 3.2.2 انتخاب ویژگی‌ها

**ویژگی‌های اصلی (29 ویژگی - بدون Data Leakage):**

**آمار تهاجمی:** goals, assists, shots_ontarget, shots_offtarget, chances2score
**آمار پاس:** keypasses, passes_acc, passes_inacc  
**آمار دریبل:** drib_success, drib_unsuccess
**آمار دفاعی:** tackles, interceptions, clearances
**آمار فیزیکی:** aerials_w, aerials_l, grduels_w, grduels_l
**آمار کلی:** touches, poss_lost, fouls, wasfouled, shotsblocked
**آمار انضباطی:** ycards, rcards, dangmistakes
**مشخصات کلی:** competition, pos, pos_role, team

**نکته مهم:** `normalized_rating` و `rater` از ویژگی‌ها حذف شدند تا از Data Leakage جلوگیری شود.
passes_acc, passes_inacc, tackles, interceptions,
fouls, wasfouled

````

#### 3.2.3 کدگذاری دسته‌ای

- **One-Hot Encoding** برای متغیرهای دسته‌ای
- **افزایش ابعاد** از 16 به 115 ویژگی

### 3.3 تقسیم داده‌ها

- **آموزش:** 80% (40,521 نمونه)
- **آزمون:** 20% (10,131 نمونه)
- **روش:** Stratified Split (حفظ توزیع کلاس‌ها)

---

## 4. پیاده‌سازی و نتایج {#پیاده‌سازی-و-نتایج}

### 4.1 مدل‌های ماشین لرنینگ

#### 4.1.1 مدل‌های آزمایش شده

1. **Logistic Regression** (با StandardScaler)
2. **Decision Tree**
3. **Random Forest**
4. **Gradient Boosting**
5. **LightGBM**

**نکته:** XGBoost به دلیل مشکل کدگذاری کلاس‌ها حذف شد.

#### 4.1.2 معیارهای ارزیابی

```python
- Accuracy: دقت کلی مدل
- F1-Score: میانگین وزنی F1 همه کلاس‌ها
- Precision: دقت هر کلاس
- Recall: بازخوانی هر کلاس
- Confusion Matrix: نمایش تفصیلی خطاها
````

### 4.2 نتایج نهایی (بدون Data Leakage)

| مدل                 | دقت       | F1-Score   | ویژگی                 |
| ------------------- | --------- | ---------- | --------------------- |
| **LightGBM**        | **42.6%** | **0.4243** | بهترین کارکرد کلی     |
| Gradient Boosting   | 42.4%     | 0.4234     | عملکرد نزدیک LightGBM |
| Decision Tree       | 41.7%     | 0.4142     | قابل تفسیر            |
| Logistic Regression | 41.3%     | 0.4123     | سریع و ساده           |
| Random Forest       | 33.4%     | 0.3332     | Overfitting           |

### 4.3 تحلیل مدل برتر (LightGBM)

#### 4.3.1 مقایسه با خط مبنا

- **خط مبنا (کلاس غالب):** 28.2%
- **LightGBM:** 42.6%
- **بهبود:** 1.5 برابر بهتر از خط مبنا

#### 4.3.2 گزارش طبقه‌بندی

```
              precision    recall  f1-score   support
   excellent       0.45      0.36      0.40      2421
        good       0.36      0.36      0.36      2292
        poor       0.45      0.45      0.45      2557
        weak       0.44      0.51      0.47      2861

    accuracy                           0.43     10131
```

#### 4.3.3 نکات مهم

- **کلاس weak:** بالاترین recall (51.2%)
- **کلاس‌های excellent/poor:** precision بهتر (45%)
- **کلاس good:** کمترین عملکرد (36% در همه معیارها)

## 5. بهبود عملکرد {#بهبود-عملکرد}

### 5.1 مهندسی ویژگی پیشرفته

#### 5.1.1 ویژگی‌های اضافی

```python
enhanced_features = [
    # ویژگی‌های اصلی +
    'clearances', 'crosses_acc', 'crosses_inacc',
    'lballs_acc', 'lballs_inacc', 'grduels_w', 'grduels_l',
    'aerials_w', 'aerials_l', 'drib_success', 'drib_unsuccess'
]
```

#### 5.1.2 ویژگی‌های مشتق

```python
# نرخ‌های موثریت
shot_accuracy = shots_ontarget / (shots_ontarget + shots_offtarget)
pass_accuracy = passes_acc / (passes_acc + passes_inacc)
aerial_success = aerials_w / (aerials_w + aerials_l)
dribble_success = drib_success / (drib_success + drib_unsuccess)
```

### 5.2 تکنیک‌های پیشرفته

#### 5.2.1 Feature Scaling

```python
scaler = StandardScaler()
# اعمال روی ویژگی‌های عددی
X_scaled = scaler.fit_transform(numerical_features)
```

#### 5.2.2 مدل‌های بهینه‌سازی شده

```python
optimized_models = {
    'Random Forest': n_estimators=200, max_depth=15,
    'XGBoost': n_estimators=200, max_depth=8, learning_rate=0.1,
    'LightGBM': n_estimators=200, max_depth=10
}
```

#### 5.2.3 Ensemble Methods

## 5. تحلیل عمیق‌تر {#بهبود-عملکرد}

### 5.1 Feature Importance Analysis

**مهم‌ترین ویژگی‌ها (براساس LightGBM):**

1. آمار تهاجمی: goals, assists, shots_ontarget
2. آمار پاس: keypasses, passes_acc
3. آمار دفاعی: tackles, interceptions
4. مشخصات زمینه‌ای: team, competition

### 5.2 تحلیل خطاهای مدل

**نقاط ضعف:**

- تشخیص دشوار کلاس "good" (36% recall)
- اشتباه بین کلاس‌های مجاور (weak ↔ poor)

**نقاط قوت:**

- عملکرد خوب در تشخیص "weak" (51% recall)
- تعادل نسبی بین precision و recall

---

## 6. نتیجه‌گیری {#نتیجه‌گیری}

### 6.1 خلاصه دستاورد‌ها

#### 6.1.1 تکنیکال

- **پیاده‌سازی موفق:** 5 الگوریتم ML بدون Data Leakage
- **بهترین دقت:** 42.6% با LightGBM
- **بهبود معنادار:** 1.5 برابر بهتر از baseline
- **مدل قابل تفسیر:** feature importance و confusion matrix

#### 6.1.2 کاربردی

- **سیستم طبقه‌بندی عملکرد** قابل استفاده
- **ابزار کمکی** برای مربیان و تحلیل‌گران
- **پایه‌ای برای توسعه** سیستم‌های پیچیده‌تر

### 6.2 محدودیت‌ها و چالش‌ها

#### 6.2.1 محدودیت‌های ذاتی

- **پیچیدگی فوتبال:** عوامل روانی و تاکتیکی نادیده گرفته شده
- **4-class problem:** طبقه‌بندی چندکلاسه بطور ذاتی سخت‌تر است
- **عدم تعادل عملکرد:** کلاس "good" کمترین دقت را دارد

#### 6.2.2 محدودیت‌های داده

- **کیفیت نمره‌دهی:** وابسته به نظر رسانه‌ها
- **دوره زمانی محدود:** 2016-2018 فقط
- **عدم یکسانی معیارها:** رسانه‌های مختلف، استانداردهای مختلف

### 6.3 ارزش علمی و کاربردی

#### 6.3.1 کنترل Data Leakage

✅ **موفقیت کلیدی:** شناسایی و حل مشکل Data Leakage که دقت 96%+ غیرواقعی ایجاد می‌کرد.

#### 6.3.2 نتایج واقع‌گرایانه

✅ **42.6% دقت معنادار است** برای مسئله‌ای با چنین پیچیدگی

#### 6.3.3 قابلیت توسعه

✅ **چارچوب قابل تعمیم** برای سایر ورزش‌ها و سطوح

### 6.4 پیشنهادات آینده

1. **ویژگی‌های بیشتر:** اضافه کردن آمار تاکتیکی و موقعیتی
2. **داده‌های زمانی:** تحلیل ترند عملکرد در طول زمان
3. **مدل‌های Deep Learning:** استفاده از شبکه‌های عصبی پیچیده‌تر
4. **تعمیم به ورزش‌های دیگر:** اعمال روش مشابه در بسکتبال، والیبال و...

#### 6.3.1 بهبود داده‌ها

- **اضافه کردن آمار تاکتیکی:** موقعیت‌یابی، فشار، حرکات بدون توپ
- **آمار فیزیولوژیک:** سرعت، شتاب، ضربان قلب
- **عوامل محیطی:** آب و هوا، زمین، تماشاگران

#### 6.3.2 بهبود مدل‌ها

- **Deep Learning:** شبکه‌های عصبی پیچیده‌تر
- **Time Series Analysis:** در نظر گیری روند عملکرد
- **Multi-task Learning:** پیش‌بینی همزمان چندین متغیر

#### 6.3.3 کاربردهای عملی

- **Real-time Analysis:** تحلیل زنده بازی‌ها
- **Player Scouting:** سیستم جستجوی بازیکن
- **Team Strategy:** بهینه‌سازی ترکیب تیم

---

## 7. پیوست‌ها {#پیوست‌ها}

### پیوست الف: کدهای کلیدی

#### A.1 ایجاد متغیر هدف

```python
def create_performance_category(rating):
    if rating <= q1:
        return 'افتضاح'
    elif rating <= q2:
        return 'ضعیف'
    elif rating <= q3:
        return 'خوب'
    else:
        return 'عالی'

df['performance_category'] = df['normalized_rating'].apply(create_performance_category)
```

#### A.2 آموزش مدل‌ها

```python
models = {
    'LightGBM': lgb.LGBMClassifier(random_state=42, verbose=-1),
    'XGBoost': xgb.XGBClassifier(random_state=42, eval_metric='mlogloss'),
    'Random Forest': RandomForestClassifier(random_state=42, n_estimators=100)
}

for name, model in models.items():
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    accuracy = accuracy_score(y_test, y_pred)
    print(f"{name}: {accuracy:.4f}")
```

### پیوست ب: نتایج تفصیلی

#### B.1 Feature Importance (LightGBM)

```
1. normalized_rating: 0.425
2. rater_WhoScored: 0.318
3. rater_SofaScore: 0.287
4. team_Argentina: 0.124
5. competition_Premier League: 0.089
```

#### B.2 Classification Report

```
              precision    recall  f1-score   support

      افتضاح       0.45      0.45      0.45      2555
       ضعیف       0.43      0.43      0.43      2576
       خوب       0.44      0.44      0.44      2613
       عالی       0.43      0.43      0.43      2387

    accuracy                           0.44     10131
   macro avg       0.44      0.44      0.44     10131
weighted avg       0.44      0.44      0.44     10131
```

### پیوست ج: منابع و مراجع

1. Scikit-learn Documentation: https://scikit-learn.org/
2. XGBoost Documentation: https://xgboost.readthedocs.io/
3. LightGBM Documentation: https://lightgbm.readthedocs.io/
4. Pandas Documentation: https://pandas.pydata.org/
5. Football Analytics Research Papers
6. Machine Learning Best Practices

---

## نتیجه‌گیری نهایی

این پروژه نشان داد که **یادگیری ماشین می‌تواند برای پیش‌بینی عملکرد بازیکنان فوتبال مفید باشد**، اگرچه با محدودیت‌هایی روبرو است. دقت 43.5% که توسط مدل LightGBM حاصل شد، نشان‌دهنده **عملکرد قابل قبول** برای این مسئله پیچیده است.

**نکات مهم:**

- Data leakage یکی از مهم‌ترین چالش‌های پروژه بود که با موفقیت حل شد
- انتخاب ویژگی مناسب از افزایش ابعاد مهم‌تر است
- مسائل دنیای واقعی همیشه پیچیده‌تر از تئوری هستند

**ارزش پروژه:**
این پروژه می‌تواند به عنوان **پایه‌ای برای سیستم‌های پیچیده‌تر تحلیل فوتبال** استفاده شود و راهکارهای عملی برای صنعت ورزش ارائه دهد.

---

**امضا:**  
[نام دانشجو]  
[تاریخ]
